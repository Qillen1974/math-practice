<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Practice - Step by Step</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: #4a5568;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2rem;
            margin-bottom: 5px;
        }
        
        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 20px;
            background: #f7fafc;
        }
        
        .mode-btn {
            padding: 15px 30px;
            font-size: 1.1rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .mode-btn.active {
            background: #667eea;
            color: white;
            transform: scale(1.05);
        }
        
        .mode-btn:not(.active) {
            background: #e2e8f0;
            color: #4a5568;
        }
        
        .practice-area {
            padding: 30px;
        }
        
        .problem-display {
            background: #f7fafc;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .problem {
            font-size: 3rem;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 20px;
        }
        
        .steps-container {
            min-height: 200px;
        }
        
        .step {
            background: #edf2f7;
            border-radius: 10px;
            padding: 20px;
            margin: 10px 0;
            font-size: 1.5rem;
            opacity: 0;
            transform: translateY(20px);
            animation: slideIn 0.5s forwards;
        }
        
        .step.correct {
            background: #c6f6d5;
            border-left: 5px solid #48bb78;
        }
        
        .step.incorrect {
            background: #fed7d7;
            border-left: 5px solid #f56565;
        }
        
        @keyframes slideIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .input-area {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .answer-input {
            padding: 15px 20px;
            font-size: 1.5rem;
            border: 3px solid #e2e8f0;
            border-radius: 10px;
            width: 150px;
            text-align: center;
            transition: border-color 0.3s;
        }
        
        .answer-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .submit-btn {
            padding: 15px 30px;
            font-size: 1.2rem;
            background: #48bb78;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }
        
        .submit-btn:hover {
            transform: scale(1.05);
        }
        
        .feedback {
            text-align: center;
            font-size: 1.5rem;
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
        }
        
        .feedback.correct {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .feedback.incorrect {
            background: #fed7d7;
            color: #742a2a;
        }
        
        .next-btn {
            display: block;
            margin: 20px auto;
            padding: 15px 40px;
            font-size: 1.2rem;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }
        
        .score {
            text-align: center;
            font-size: 1.2rem;
            color: #718096;
            padding: 10px;
        }
        
        .animation-area {
            background: #1a202c;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            min-height: 250px;
            color: white;
            font-family: 'Courier New', monospace;
        }
        
        .animation-step {
            font-size: 2rem;
            margin: 15px 0;
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .show-animation-btn {
            display: block;
            margin: 10px auto;
            padding: 12px 25px;
            font-size: 1rem;
            background: #ed8936;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .difficulty-selector {
            text-align: center;
            margin: 15px 0;
        }
        
        .difficulty-selector label {
            font-size: 1.1rem;
            margin-right: 10px;
        }
        
        .difficulty-selector select {
            padding: 8px 15px;
            font-size: 1rem;
            border-radius: 5px;
            border: 2px solid #e2e8f0;
        }
        
        .hint-text {
            text-align: center;
            color: #718096;
            font-size: 1rem;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî¢ Math Practice</h1>
            <p>Learn step by step!</p>
        </div>
        
        <div class="mode-selector">
            <button class="mode-btn active" onclick="setMode('decimal')">‚ûï‚ûñ Decimals</button>
            <button class="mode-btn" onclick="setMode('multiply')">‚úñÔ∏è Multiplication</button>
        </div>
        
        <div class="practice-area">
            <div class="difficulty-selector">
                <label>Difficulty:</label>
                <select id="difficulty" onchange="generateProblem()">
                    <option value="easy">Easy</option>
                    <option value="medium" selected>Medium</option>
                    <option value="hard">Hard</option>
                </select>
            </div>
            
            <div class="problem-display">
                <div class="problem" id="problem">12.5 + 3.25 = ?</div>
                <p class="hint-text" id="hint">Enter your answer below</p>
            </div>
            
            <button class="show-animation-btn" onclick="showAnimation()">üëÅÔ∏è Watch How to Solve</button>
            
            <div class="animation-area" id="animationArea"></div>
            
            <div class="input-area">
                <input type="text" class="answer-input" id="answerInput" placeholder="?">
                <button class="submit-btn" onclick="checkAnswer()">Check ‚úÖ</button>
            </div>
            
            <div class="feedback" id="feedback" style="display: none;"></div>
            
            <button class="next-btn" id="nextBtn" style="display: none;" onclick="generateProblem()">Next Problem ‚û°Ô∏è</button>
            
            <div class="score" id="score">Score: 0 / 0</div>
        </div>
    </div>

    <script>
        let currentMode = 'decimal';
        let currentProblem = {};
        let score = { correct: 0, total: 0 };
        let animationTimeout = null;
        
        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.toLowerCase().includes(mode === 'decimal' ? 'decimal' : 'multiplication')) {
                    btn.classList.add('active');
                }
            });
            generateProblem();
        }
        
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        
        function generateDecimalProblem(difficulty) {
            let num1, num2, operator;
            
            if (difficulty === 'easy') {
                num1 = getRandomInt(1, 9) + getRandomInt(1, 9) / 10;
                num2 = getRandomInt(1, 9) + getRandomInt(1, 9) / 10;
                operator = Math.random() > 0.5 ? '+' : '-';
            } else if (difficulty === 'medium') {
                num1 = getRandomInt(10, 99) + getRandomInt(1, 99) / 100;
                num2 = getRandomInt(10, 99) + getRandomInt(1, 99) / 100;
                operator = Math.random() > 0.5 ? '+' : '-';
            } else {
                num1 = getRandomInt(100, 999) + getRandomInt(1, 99) / 100;
                num2 = getRandomInt(100, 999) + getRandomInt(1, 99) / 100;
                operator = Math.random() > 0.5 ? '+' : '-';
            }
            
            // Ensure positive result for subtraction
            if (operator === '-' && num1 < num2) {
                [num1, num2] = [num2, num1];
            }
            
            const answer = operator === '+' ? num1 + num2 : num1 - num2;
            
            return {
                num1: parseFloat(num1.toFixed(2)),
                num2: parseFloat(num2.toFixed(2)),
                operator: operator,
                answer: parseFloat(answer.toFixed(2)),
                type: 'decimal'
            };
        }
        
        function generateMultiplyProblem(difficulty) {
            let num1, num2;
            
            if (difficulty === 'easy') {
                num1 = getRandomInt(11, 20);
                num2 = getRandomInt(2, 9);
            } else if (difficulty === 'medium') {
                num1 = getRandomInt(11, 30);
                num2 = getRandomInt(11, 30);
            } else {
                num1 = getRandomInt(31, 99);
                num2 = getRandomInt(31, 99);
            }
            
            return {
                num1: num1,
                num2: num2,
                operator: '√ó',
                answer: num1 * num2,
                type: 'multiply'
            };
        }
        
        function generateProblem() {
            const difficulty = document.getElementById('difficulty').value;
            
            if (currentMode === 'decimal') {
                currentProblem = generateDecimalProblem(difficulty);
            } else {
                currentProblem = generateMultiplyProblem(difficulty);
            }
            
            document.getElementById('problem').textContent = 
                `${currentProblem.num1} ${currentProblem.operator} ${currentProblem.num2} = ?`;
            document.getElementById('answerInput').value = '';
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('animationArea').innerHTML = '';
            
            if (animationTimeout) clearTimeout(animationTimeout);
        }
        
        function showAnimation() {
            const area = document.getElementById('animationArea');
            area.innerHTML = '';
            
            if (currentProblem.type === 'decimal') {
                showDecimalAnimation();
            } else {
                showMultiplyAnimation();
            }
        }
        
        function showDecimalAnimation() {
            const area = document.getElementById('animationArea');
            const { num1, num2, operator, answer } = currentProblem;
            
            // Get integer and decimal parts
            const n1Int = Math.floor(num1);
            const n1Dec = Math.round((num1 - n1Int) * 100);
            const n2Int = Math.floor(num2);
            const n2Dec = Math.round((num2 - n2Int) * 100);
            
            // Format with proper decimal alignment - always show 2 decimal places
            const padNum = (n) => {
                const intPart = Math.floor(n);
                const decPart = Math.round((n - intPart) * 100);
                return intPart + '.' + String(decPart).padStart(2, '0');
            };
            
            const n1Str = padNum(num1);
            const n2Str = padNum(num2);
            const width = 8; // " 12.34 " format
            
            let steps = [];
            
            const fmt = (s) => s.padStart(width);
            
            if (operator === '+') {
                steps.push(`üìù ${n1Str} + ${n2Str}`);
                steps.push(``);
                steps.push(`üìù Step 1: Add decimals (right to left)`);
                steps.push(`   ${fmt(n1Str)}`);
                steps.push(` + ${fmt(n2Str)}`);
                steps.push(`   ${'‚îÄ'.repeat(width)}`);
                
                // Calculate decimal addition
                const decSum = n1Dec + n2Dec;
                const carry = Math.floor(decSum / 100);
                const newDec = decSum % 100;
                
                if (carry > 0) {
                    steps.push(`   ${n1Dec} + ${n2Dec} = ${decSum}`);
                    steps.push(`   Carry ${carry} to ones! ‚û°Ô∏è`);
                    steps.push(``);
                    steps.push(`üìù Step 2: Add ones + carry`);
                    steps.push(`   ${n1Int} + ${n2Int} + ${carry} = ${n1Int + n2Int + carry}`);
                    steps.push(``);
                }
                
                steps.push(`üéØ ${n1Str} + ${n2Str} = ${padNum(answer)}`);
                
            } else {
                // Subtraction - show borrowing!
                steps.push(`üìù ${n1Str} - ${n2Str}`);
                steps.push(``);
                
                // Check if borrowing is needed
                const needBorrow = n1Dec < n2Dec;
                
                if (needBorrow) {
                    const newInt = n1Int - 1;
                    const newDec = n1Dec + 100 - n2Dec;
                    
                    steps.push(`üìù Step 1: ${n1Dec} - ${n2Dec}?`);
                    steps.push(`   Not enough! Need to borrow üëâ`);
                    steps.push(``);
                    steps.push(`üìù Step 2: Borrow 1 from ones`);
                    steps.push(`   ${fmt(n1Str)}`);
                    steps.push(` - ${fmt(n2Str)}`);
                    steps.push(`   ${'‚îÄ'.repeat(width)}`);
                    steps.push(`   ${newInt}.${String(newDec).padStart(2,'0')} ‚Üê after borrow`);
                    steps.push(``);
                    steps.push(`üìù Step 3: Subtract`);
                    steps.push(`   ${newDec} - ${n2Dec} = ${newDec - n2Dec}`);
                    steps.push(`   ${newInt} - ${n2Int} = ${newInt - n2Int}`);
                    steps.push(``);
                } else {
                    steps.push(`üìù Step 1: Subtract decimals`);
                    steps.push(`   ${fmt(n1Str)}`);
                    steps.push(` - ${fmt(n2Str)}`);
                    steps.push(`   ${'‚îÄ'.repeat(width)}`);
                    steps.push(`   ${n1Dec} - ${n2Dec} = ${n1Dec - n2Dec}`);
                    steps.push(``);
                    steps.push(`üìù Step 2: Subtract ones`);
                    steps.push(`   ${n1Int} - ${n2Int} = ${n1Int - n2Int}`);
                    steps.push(``);
                }
                
                steps.push(`üéØ ${n1Str} - ${n2Str} = ${padNum(answer)}`);
            }
            
            displayAnimationSteps(steps);
        }
        
        function showMultiplyAnimation() {
            const area = document.getElementById('animationArea');
            const { num1, num2, answer } = currentProblem;
            
            let steps = [];
            const n1Str = num1.toString();
            const n2Str = num2.toString();
            
            steps.push(`üìù ${num1} √ó ${n2Str}`);
            steps.push(``);
            
            // Show each digit multiplication with carry
            steps.push(`üìù Step 1: Multiply each digit of ${n2Str} by ${n1Str}`);
            steps.push(``);
            
            // For each digit in n2 (from right to left)
            let results = [];
            for (let i = n2Str.length - 1; i >= 0; i--) {
                const n2Digit = parseInt(n2Str[i]);
                const pos = n2Str.length - 1 - i;
                
                // Show the multiplication for this digit
                let explanation = `   ${n1Str} √ó ${n2Digit} = `;
                let products = [];
                let total = 0;
                let carry = 0;
                
                for (let j = n1Str.length - 1; j >= 0; j--) {
                    const n1Digit = parseInt(n1Str[j]);
                    const prod = n1Digit * n2Digit + carry;
                    const digit = prod % 10;
                    carry = Math.floor(prod / 10);
                    products.unshift({digit, carry});
                    total = prod;
                }
                
                // Format the result with zeros
                const resultStr = total.toString().padStart(n1Str.length + pos, ' ');
                results.push(resultStr);
                
                steps.push(`${explanation}${total}`);
            }
            
            steps.push(``);
            steps.push(`üìù Step 2: Write partial products`);
            results.forEach((r, i) => {
                steps.push(`      ${r}`);
            });
            
            // Add zeros for alignment
            const maxLen = results[results.length - 1].length;
            const alignedResults = results.map((r, i) => {
                return ' '.repeat(i) + r;
            });
            
            steps.push(`    ${'‚îÄ'.repeat(maxLen)}`);
            alignedResults.forEach(r => {
                steps.push(`      ${r}`);
            });
            
            steps.push(`    ${'‚îÄ'.repeat(maxLen)}`);
            steps.push(`      ${answer}`);
            steps.push(``);
            steps.push(`üéØ ${num1} √ó ${n2Str} = ${answer}`);
            
            displayAnimationSteps(steps);
        }
        
        function displayAnimationSteps(steps) {
            const area = document.getElementById('animationArea');
            area.innerHTML = '';
            
            steps.forEach((step, index) => {
                const div = document.createElement('div');
                div.className = 'animation-step';
                div.textContent = step;
                div.style.animationDelay = `${index * 0.8}s`;
                area.appendChild(div);
            });
        }
        
        function checkAnswer() {
            const userAnswer = parseFloat(document.getElementById('answerInput').value);
            const feedback = document.getElementById('feedback');
            
            if (isNaN(userAnswer)) {
                feedback.textContent = 'Please enter a number! üìù';
                feedback.className = 'feedback incorrect';
                feedback.style.display = 'block';
                return;
            }
            
            score.total++;
            
            // Check with 2 decimal places for decimals
            const correct = currentProblem.type === 'decimal' 
                ? Math.abs(userAnswer - currentProblem.answer) < 0.01
                : userAnswer === currentProblem.answer;
            
            if (correct) {
                score.correct++;
                feedback.textContent = 'üéâ Correct! Great job!';
                feedback.className = 'feedback correct';
                playSound('correct');
            } else {
                feedback.innerHTML = `‚ùå Not quite.<br>The answer is ${currentProblem.answer}`;
                feedback.className = 'feedback incorrect';
                playSound('incorrect');
            }
            
            feedback.style.display = 'block';
            document.getElementById('nextBtn').style.display = 'block';
            document.getElementById('score').textContent = 
                `Score: ${score.correct} / ${score.total}`;
        }
        
        function playSound(type) {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                if (type === 'correct') {
                    oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                    oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                } else {
                    oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(150, audioContext.currentTime + 0.2);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.4);
                }
            } catch (e) {
                console.log('Audio not supported');
            }
        }
        
        // Handle Enter key
        document.getElementById('answerInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkAnswer();
            }
        });
        
        // Initialize
        generateProblem();
    </script>
</body>
</html>
